import{r as o,j as e,T as w,Z as k,B as v,c as D,X as O}from"./index-BgW-1nVu.js";import{generateGameQuestions as q,gradeOpenEndedAnswer as E}from"./geminiService-CxjPenrf.js";const G=[{topicId:"1",title:"Cell Biology",level:"Secure",xp:450},{topicId:"2",title:"Atomic Structure",level:"Developing",xp:120},{topicId:"3",title:"Energetics",level:"Novice",xp:0}],M=({files:b})=>{const[y,d]=o.useState("DASHBOARD"),[s,c]=o.useState(null),[A,f]=o.useState(!1),[x,u]=o.useState(""),[r,h]=o.useState(null),[g,p]=o.useState(!1),j=async(t,l)=>{f(!0);const n=await q(l,t,b,5);c({id:Date.now().toString(),mode:t,questions:n,currentQuestionIndex:0,score:0,answers:[],status:"active"}),f(!1),d("PLAYING"),u(""),h(null)},S=t=>{var N;if(!s)return;const l=s.questions[s.currentQuestionIndex],n=t===l.correctOptionIndex,Q=[...s.answers,{questionId:l.id,userAnswer:((N=l.options)==null?void 0:N[t])||"",isCorrect:n}];c({...s,score:n?s.score+1:s.score,answers:Q})},C=async()=>{if(!s)return;p(!0);const t=s.questions[s.currentQuestionIndex],l=await E(t.text,x,t.markScheme||[]);h(l),p(!1);const n=[...s.answers,{questionId:t.id,userAnswer:x,isCorrect:l.score>=l.maxScore/2,feedback:l.feedback}];c({...s,score:s.score+l.score,answers:n})},I=()=>{s&&(s.currentQuestionIndex>=s.questions.length-1?c({...s,status:"completed"}):(c({...s,currentQuestionIndex:s.currentQuestionIndex+1}),u(""),h(null)))};if(y==="DASHBOARD")return e.jsxs("div",{className:"p-8 max-w-6xl mx-auto animate-fadeIn",children:[e.jsxs("header",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-900 flex items-center gap-3",children:[e.jsx(w,{className:"w-8 h-8 text-yellow-500"}),"Game Center"]}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Turn your notes into high-stakes exams. Master topics to level up."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-12",children:G.map(t=>e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm relative overflow-hidden group",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:t.title}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold uppercase
                      ${t.level==="Secure"?"bg-green-100 text-green-700":t.level==="Developing"?"bg-amber-100 text-amber-700":"bg-slate-100 text-slate-500"}`,children:t.level})]}),e.jsxs("div",{className:"text-sm text-slate-500 mb-4",children:[t.xp," XP"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>j("MCQ_ARENA",t.title),className:"w-full py-2 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-lg text-sm font-semibold transition-colors flex items-center justify-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"})," Smart MCQ"]}),e.jsxs("button",{onClick:()=>j("EXPLAIN_TO_WIN",t.title),className:"w-full py-2 bg-white border-2 border-slate-100 hover:border-indigo-200 text-slate-600 hover:text-indigo-600 rounded-lg text-sm font-semibold transition-colors flex items-center justify-center gap-2",children:[e.jsx(v,{className:"w-4 h-4"})," Explain to Win"]})]})]}),e.jsx("div",{className:"absolute -right-4 -bottom-4 w-24 h-24 bg-slate-50 rounded-full group-hover:scale-150 transition-transform duration-500 ease-out z-0"})]},t.topicId))})]});if(A)return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-6"}),e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Constructing Exam..."}),e.jsxs("p",{className:"text-slate-500",children:["Analyzing ",b.length," documents for syllabus alignment."]})]});if(!s)return null;if(s.status==="completed"){const t=D(s.score,s.questions.length);return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center animate-fadeIn",children:[e.jsx("div",{className:"w-24 h-24 bg-yellow-100 rounded-full flex items-center justify-center mb-6 shadow-lg shadow-yellow-500/20",children:e.jsx(w,{className:"w-12 h-12 text-yellow-600"})}),e.jsx("h2",{className:"text-4xl font-bold text-slate-900 mb-2",children:"Session Complete!"}),e.jsxs("p",{className:"text-slate-500 mb-8 text-lg",children:["You scored ",s.score," / ",s.questions.length]}),e.jsxs("div",{className:"w-full max-w-md bg-white p-6 rounded-2xl border border-slate-200 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold text-slate-700",children:"Accuracy"}),e.jsxs("span",{className:"font-bold text-indigo-600",children:[t,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-100 h-3 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-indigo-600 h-full transition-all duration-1000",style:{width:`${t}%`}})})]}),e.jsx("button",{onClick:()=>d("DASHBOARD"),className:"px-8 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-500/30",children:"Return to Game Center"})]})}if(!s.questions||s.questions.length===0)return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(O,{className:"w-8 h-8 text-slate-400"})}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 mb-2",children:"No Questions Available"}),e.jsx("p",{className:"text-slate-500 mb-6",children:"Could not generate questions for this topic. Please try again or choose a different topic."}),e.jsx("button",{onClick:()=>d("DASHBOARD"),className:"px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition-colors",children:"Return to Dashboard"})]});const i=s.questions[s.currentQuestionIndex];if(!i)return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center",children:[e.jsx("p",{className:"text-red-500",children:"Error: Question index out of bounds."}),e.jsx("button",{onClick:()=>d("DASHBOARD"),className:"mt-4 text-indigo-600 underline",children:"Return to Dashboard"})]});const m=s.answers.some(t=>t.questionId===i.id),a=s.answers.find(t=>t.questionId===i.id);return e.jsxs("div",{className:"h-full flex flex-col max-w-4xl mx-auto p-4 md:p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("button",{onClick:()=>d("DASHBOARD"),className:"text-slate-400 hover:text-slate-600 font-medium",children:"Exit Game"}),e.jsx("div",{className:"flex gap-2",children:s.questions.map((t,l)=>e.jsx("div",{className:`w-3 h-3 rounded-full 
               ${l===s.currentQuestionIndex?"bg-indigo-600 scale-125":l<s.currentQuestionIndex?"bg-indigo-200":"bg-slate-200"}`},l))}),e.jsxs("div",{className:"font-bold text-indigo-600",children:["Score: ",s.score]})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[e.jsx("div",{className:"bg-white p-8 md:p-12 rounded-3xl shadow-xl shadow-indigo-900/5 border border-slate-200 relative overflow-hidden",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("span",{className:"inline-block px-3 py-1 bg-indigo-50 text-indigo-600 text-xs font-bold uppercase tracking-wider rounded-full mb-4",children:[i.difficulty," Difficulty"]}),e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-slate-900 mb-8 leading-relaxed",children:i.text}),s.mode==="MCQ_ARENA"&&i.options&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.options.map((t,l)=>{let n="p-4 rounded-xl border-2 text-left font-medium transition-all duration-200 hover:scale-[1.02] ";return m?l===i.correctOptionIndex?n+="bg-green-50 border-green-500 text-green-700 ":(a==null?void 0:a.userAnswer)===t?n+="bg-red-50 border-red-500 text-red-700 ":n+="bg-slate-50 border-slate-200 text-slate-400 opacity-50 ":n+="bg-white border-slate-200 hover:border-indigo-500 hover:text-indigo-700 hover:bg-indigo-50 cursor-pointer ",e.jsxs("button",{disabled:m,onClick:()=>S(l),className:n,children:[e.jsxs("span",{className:"mr-2 opacity-50",children:[String.fromCharCode(65+l),"."]})," ",t]},l)})}),s.mode==="EXPLAIN_TO_WIN"&&e.jsx("div",{className:"space-y-4",children:m?e.jsxs("div",{className:`p-6 rounded-xl border ${r&&r.score>0?"bg-green-50 border-green-200":"bg-amber-50 border-amber-200"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"font-bold text-slate-900",children:"Examiner Feedback"}),e.jsxs("span",{className:"font-bold text-lg",children:[r==null?void 0:r.score," / ",r==null?void 0:r.maxScore," Marks"]})]}),e.jsx("p",{className:"text-slate-700 mb-4",children:r==null?void 0:r.feedback}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Your Answer:"}),e.jsxs("p",{className:"text-slate-600 text-sm italic",children:['"',a==null?void 0:a.userAnswer,'"']})]}):e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:x,onChange:t=>u(t.target.value),placeholder:"Type your explanation here. Be specific and use keywords...",className:"w-full h-40 p-4 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-indigo-500/50 outline-none resize-none"}),e.jsx("button",{onClick:C,disabled:!x.trim()||g,className:"w-full py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 disabled:opacity-50 transition-all flex items-center justify-center gap-2",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/50 border-t-white rounded-full animate-spin"}),"Grading with Mark Scheme..."]}):"Submit Answer"})]})})]})}),m&&e.jsx("div",{className:"mt-6 animate-slideUp",children:e.jsxs("div",{className:"bg-slate-900 text-white p-6 rounded-2xl shadow-lg flex flex-col md:flex-row gap-6 items-start md:items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-indigo-300 font-bold text-xs uppercase tracking-wider",children:[e.jsx(v,{className:"w-4 h-4"}),"Study OS Logic"]}),e.jsx("p",{className:"text-slate-100 leading-relaxed",children:i.explanation}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500 font-mono",children:["Source: ",i.sourceCitation]})]}),e.jsx("button",{onClick:I,className:"px-6 py-3 bg-white text-slate-900 font-bold rounded-xl hover:scale-105 transition-transform whitespace-nowrap",children:s.currentQuestionIndex>=s.questions.length-1?"Finish Game":"Next Question"})]})})]})]})};export{M as default};
