import{r,j as e,L as E,E as p,A as b,f as k}from"./index-BgW-1nVu.js";import{generateExamPaper as A}from"./geminiService-CxjPenrf.js";const M=({files:S})=>{const[i,c]=r.useState("SETUP"),[a,I]=r.useState(null),[L,C]=r.useState({}),[x,g]=r.useState(0),[j,w]=r.useState(!1),[d,N]=r.useState(0),[u,h]=r.useState(null),T=async()=>{try{document.documentElement.requestFullscreen&&await document.documentElement.requestFullscreen()}catch(s){console.warn("Fullscreen denied or failed:",s),alert("Exam requires Fullscreen mode. Please allow fullscreen to proceed.");return}w(!0);const t="Cell Biology & Transport";try{const s=await A(t,S),l={id:"exam-"+Date.now(),title:`Paper 1: ${t}`,durationMinutes:10,totalMarks:s.reduce((n,m)=>n+(m.marks||1),0),questions:s};I(l),g(l.durationMinutes*60),N(0),h(null),c("EXAM")}catch(s){console.error("Exam start failed:",s),document.fullscreenElement&&document.exitFullscreen().catch(()=>{})}finally{w(!1)}};r.useEffect(()=>{if(i==="EXAM"&&x>0){const t=setInterval(()=>g(s=>s-1),1e3);return()=>clearInterval(t)}else i==="EXAM"&&x===0&&y()},[i,x]),r.useEffect(()=>{if(i!=="EXAM")return;const t=()=>{document.hidden&&o("Visual attention loss detected (Tab Switch). Focus is required.")},s=()=>{o("Focus lost (Window Click-away). Remain in the exam environment.")},l=()=>{document.fullscreenElement||o("Secure environment breach (Fullscreen Exit).")},n=m=>{m.preventDefault(),o("Unauthorized interface interaction (Right Click).")};return document.addEventListener("visibilitychange",t),window.addEventListener("blur",s),document.addEventListener("fullscreenchange",l),document.addEventListener("contextmenu",n),()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("blur",s),document.removeEventListener("fullscreenchange",l),document.removeEventListener("contextmenu",n)}},[i,d]);const o=t=>{N(s=>{const l=s+1;return h(`VIOLATION ${l}/3: ${t}`),l>=3?(document.fullscreenElement&&document.exitFullscreen().catch(()=>{}),setTimeout(()=>c("DISQUALIFIED"),1500)):setTimeout(()=>h(null),4e3),l})},v=(t,s)=>{["hey google","chatgpt","help me","what is the answer","ignore previous instructions","as an ai","system prompt"].some(n=>s.toLowerCase().includes(n))&&(u||o("Unauthorized linguistic pattern detected (Possible Agent Injection).")),C(n=>({...n,[t]:s}))},f=t=>{t.preventDefault(),o("External data injection (Paste/Copy) prohibited.")},y=()=>{document.fullscreenElement&&document.exitFullscreen().catch(()=>{}),c("RESULTS")};return i==="SETUP"?e.jsxs("div",{className:"p-8 max-w-4xl mx-auto flex flex-col items-center justify-center h-full text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-red-100 rounded-full flex items-center justify-center mb-6",children:e.jsx(E,{className:"w-12 h-12 text-red-600"})}),e.jsx("h1",{className:"text-4xl font-bold text-slate-900 mb-4",children:"Exam Simulator"}),e.jsxs("p",{className:"text-slate-500 max-w-lg mb-8",children:["Enter strict examination conditions. The ",e.jsx("strong",{children:"AI Invigilator"})," will monitor your:"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md w-full mb-8",children:[e.jsxs("div",{className:"p-4 bg-white border border-slate-200 rounded-xl text-left flex items-center gap-3",children:[e.jsx(p,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:"Tab & Focus"})]}),e.jsxs("div",{className:"p-4 bg-white border border-slate-200 rounded-xl text-left flex items-center gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-red-500"}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:"Fullscreen"})]})]}),e.jsx("button",{onClick:T,disabled:j,className:"px-8 py-4 bg-red-600 text-white text-lg font-bold rounded-2xl hover:bg-red-700 shadow-lg shadow-red-500/30 transition-transform active:scale-95 disabled:opacity-50 flex items-center gap-2",children:j?"Securing Environment...":"Begin Proctored Exam"})]}):i==="DISQUALIFIED"?e.jsxs("div",{className:"p-8 max-w-4xl mx-auto flex flex-col items-center justify-center h-full text-center animate-fadeIn",children:[e.jsx("div",{className:"w-24 h-24 bg-red-600 rounded-full flex items-center justify-center mb-6 shadow-xl shadow-red-500/40 animate-pulse",children:e.jsx(b,{className:"w-12 h-12 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-slate-900 mb-2",children:"DISQUALIFIED"}),e.jsx("p",{className:"text-red-600 font-bold mb-6 text-xl",children:"Academic Malpractice Detected"}),e.jsxs("div",{className:"bg-red-50 p-6 rounded-xl border border-red-100 max-w-md w-full mb-8",children:[e.jsx("p",{className:"text-slate-700 font-medium",children:"The AI Invigilator terminated your session due to repeated violations of the secure environment protocols."}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-red-200 flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-red-500",children:"Violations Recorded"}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:d})]})]}),e.jsx("button",{onClick:()=>c("SETUP"),className:"px-8 py-3 bg-slate-900 text-white rounded-xl font-bold hover:bg-slate-800 transition-colors",children:"Return to Dashboard"})]}):i==="RESULTS"?e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Exam Report"}),e.jsxs("div",{className:"p-6 bg-white rounded-2xl border border-slate-200 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:a==null?void 0:a.title}),e.jsx("span",{className:"px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full font-bold text-sm",children:"Grading Pending"})]}),e.jsx("p",{className:"text-slate-600",children:"Your paper has been submitted to The Examiner agent. Check your Digital Twin profile later for the detailed breakdown and grade prediction."}),d>0?e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border border-red-100 rounded-lg flex items-start gap-3",children:[e.jsx(b,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-red-700 text-sm",children:"Invigilator Report"}),e.jsxs("p",{className:"text-red-600 text-sm",children:[d," behavioral flags recorded. This may affect your predicted grade credibility."]})]})]}):e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-100 rounded-lg flex items-center gap-3 text-green-700 text-sm",children:[e.jsx(p,{className:"w-5 h-5"}),e.jsx("span",{children:"Clean session. No behavioral anomalies detected."})]})]}),e.jsx("button",{onClick:()=>c("SETUP"),className:"px-6 py-2 bg-slate-900 text-white font-bold rounded-lg",children:"Return to Simulator"})]}):e.jsxs("div",{className:`h-full flex flex-col bg-slate-50 relative ${u?"ring-4 ring-inset ring-red-500":""}`,children:[u&&e.jsx("div",{className:"absolute top-20 left-1/2 -translate-x-1/2 z-50 w-full max-w-lg px-4",children:e.jsxs("div",{className:"bg-red-600 text-white p-4 rounded-xl shadow-2xl flex items-center gap-4 animate-bounce",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center font-bold text-2xl shrink-0",children:e.jsx(b,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold uppercase tracking-wider text-xs text-red-200 mb-1",children:"Invigilator Intervention"}),e.jsx("p",{className:"font-bold text-md leading-tight",children:u.split(": ")[1]})]})]})}),e.jsxs("div",{className:"h-16 bg-slate-900 text-white flex justify-between items-center px-6 shadow-md z-10 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-mono font-bold tracking-widest text-red-400",children:"REC"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-800 px-3 py-1 rounded-full border border-slate-700",children:[e.jsx(p,{className:`w-4 h-4 ${d>0?"text-red-400":"text-emerald-400"}`}),e.jsx("span",{className:"text-xs font-bold text-slate-300",children:d===0?"MONITORING ACTIVE":"SUSPICIOUS ACTIVITY"})]}),e.jsx("div",{className:"h-6 w-px bg-slate-700 hidden md:block"}),e.jsx("div",{className:"flex items-center gap-2 text-sm hidden md:flex",children:e.jsxs("span",{className:d>0?"text-red-400 font-bold":"text-emerald-400",children:["Strikes: ",d,"/3"]})})]}),e.jsx("div",{className:`font-mono text-2xl font-bold ${x<60?"text-red-500 animate-pulse":"text-white"}`,children:k(x)}),e.jsx("button",{onClick:y,className:"px-4 py-1.5 bg-white/10 hover:bg-white/20 rounded-lg text-sm font-semibold transition-colors",children:"Submit Paper"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-8 max-w-5xl mx-auto w-full select-none",children:e.jsxs("div",{className:"bg-white p-8 md:p-12 rounded-none shadow-sm min-h-[1000px] relative border border-slate-200",children:[e.jsxs("div",{className:"text-center border-b-2 border-slate-900 pb-8 mb-12",children:[e.jsx("h2",{className:"text-3xl font-serif font-bold text-slate-900 mb-2",children:a==null?void 0:a.title}),e.jsx("p",{className:"text-slate-600 font-serif italic",children:"Candidate Name: Study OS User"}),e.jsxs("p",{className:"text-slate-600 font-serif italic",children:["Time Allowed: ",a==null?void 0:a.durationMinutes," minutes"]})]}),e.jsx("div",{className:"space-y-12",children:a==null?void 0:a.questions.map((t,s)=>{var l;return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("span",{className:"font-serif font-bold text-xl text-slate-400",children:s+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-serif text-lg text-slate-900 mb-2",children:[t.text,e.jsxs("span",{className:"float-right text-base font-sans font-bold text-slate-500",children:["[",t.marks," marks]"]})]}),t.type==="MCQ"?e.jsx("div",{className:"space-y-2 mt-4 pl-4 border-l-2 border-slate-100",children:(l=t.options)==null?void 0:l.map((n,m)=>e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group",children:[e.jsx("input",{type:"radio",name:t.id,onChange:()=>v(t.id,n),className:"w-4 h-4 text-slate-900 focus:ring-slate-900"}),e.jsx("span",{className:"font-serif text-slate-700 group-hover:text-black",children:n})]},m))}):e.jsx("div",{className:"mt-4 bg-slate-50 border-b border-slate-300",children:e.jsx("textarea",{className:"w-full bg-transparent p-4 font-serif text-lg outline-none min-h-[150px] resize-y",placeholder:"Write your answer here...",onChange:n=>v(t.id,n.target.value),onPaste:f,onCopy:f,onCut:f})})]})]})},t.id)})}),e.jsx("div",{className:"mt-20 pt-8 border-t border-slate-200 text-center text-slate-400 font-serif text-sm",children:"End of Paper"})]})})]})};export{M as default};
